{% extends 'layouts/' ~ layout ~ '.twig' %}

{% block body %}
    <div class="container">
        <h2></h2>

        <form method="post" action="{{ home }}projects/edit/{{ project.id }}" class="form-horizontal">
            <div class="form-group {{ (errors.name) ? 'has-error' : '' }}">
                <label for="name" class="col-sm-2 control-label">Titre du projet</label>

                <div class="col-sm-10">
                    <input type="text" name="name" value="{% if project.name %}{{ project.name }}{% endif %}"
                           class="form-control" id="name" placeholder="Titre du projet">
                    <span class="help-block with-errors">{% if errors.name %}{{ errors.name }}{% endif %}</span>
                </div>
            </div>
            <div class="form-group {{ (errors.description) ? 'has-error' : '' }}">
                <label for="description" class="col-sm-2 control-label">Description</label>

                <div class="col-sm-10">
                    <textarea name="description" id="description" class="form-control" rows="5"
                              placeholder="Veuillez décrire brievement votre projet">{{ (project.description) ? project.description : "" }}</textarea>
                    <span class="help-block with-errors">{% if errors.description %}{{ errors.description }}{% endif %}</span>
                </div>
            </div>
            <div class="form-group {{ (errors.url) ? 'has-error' : '' }}">
                <label for="url" class="col-sm-2 control-label">URL</label>

                <div class="col-sm-10">
                    <input type="url" name="url" value="{% if project.url %}{{ project.url }}{% endif %}"
                           class="form-control" id="url" placeholder="Adresse URL du projet (si existant)">
                    <span class="help-block with-errors">{% if errors.url %}{{ errors.url }}{% endif %}</span>
                </div>
            </div>
            <div class="form-group  {{ (errors.targets) ? 'has-error' : '' }}">
                <label for="targets" class="col-sm-2 control-label">Cibles</label>

                <div class="col-sm-10">
                    <input name="targets" type="text" class="form-control" id="targets"
                           placeholder="Adulte, Jeune, Femme ..." value="{{ project.targets }}">
                    <span class="help-block with-errors">{% if errors.targets %}{{ errors.targets }}{% endif %}</span>
                </div>
            </div>
            <div class="form-group {{ (errors.recommendation) ? 'has-error' : '' }}">
                <label for="recommendation" class="col-sm-2 control-label">Recommendations</label>

                <div class="col-sm-10">
                    <textarea name="recommendation" id="recommendation" class="form-control" rows="5"
                              placeholder="Mentionner toutes informations complémentaires pouvant faciliter le travail des Freelances.">{{ (project.recommendation) ? project.recommendation : "" }}</textarea>
                    <span class="help-block with-errors">{% if errors.recommendation %}{{ errors.recommendation }}{% endif %}</span>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-5">
                    <button type="submit" class="btn btn-default">Mettre à jour les informations</button>
                </div>
                <div class="col-sm-offset-3 col-sm-2">
                    <a class="btn btn-default" href="{{ home }}projects/delete/{{ project.id }}">Annuler le projet</a>
                </div>
            </div>
        </form>
    </div>

    {# include the list of freelance demand #}
    <div class="container">
        {% include 'projects/demand.twig' ignore missing %}
    </div>
    {# include the list of freelance demand #}

{% endblock %}

{% block partial_js %}
    {{ parent() }}
    <script>
        $('.demand').click(function (e) {
            var project_id = $(this).attr("data-project-id");
            var freelance_id = $(this).attr("data-freelance-id");
            var choice = $(this).attr("data-choice");
            var self = $(this);


            $.ajax({
                url: "{{ home }}projects/proposition/choice",
                type: "POST",
                data: {
                    project_id: project_id,
                    freelance_id: freelance_id,
                    status: choice
                }
            }).done(function (data, textStatus, jqXHR) {
                // removing button
                var container = self.parent();
                var button;

                // if not error
                if(!data.proposition.error){
                    container.empty();

                    if (data.proposition.status == "accept") {
                        button = $("<button class='demand btn btn-sm btn-success'>Accepter</button>");
                    } else if (data.proposition.status == "decline") {
                        button = $("<button class='demand btn btn-sm btn-danger'>Refuser</button>");
                    }
                    container.append(button);
                }else{
                    // else show error message
                    $('#demand-message').text(data.proposition.message).fadeIn();
                }

            }).fail(function (error) {
                console.log(error);
            });

        });
    </script>
{% endblock %}
